## filecheck plugin: monitors file mtime, checksum (SHA256), and existence
## Replaces the old filechange and mtime plugins

[[instances]]
## Targets support three forms:
## - Exact path: "/etc/shadow"
## - Glob pattern: "/etc/*.conf"
## - Directory (recursive scan): "/opt/myapp/config/"
## Max 10000 files after expansion; excess files are truncated with a warning
targets = ["/etc/shadow", "/etc/passwd"]
interval = "60s"

## Dimension 1: mtime - monitors file modification time
## mode = "changed" (default): alert if file modified within time_span (detect unexpected changes)
## mode = "stale":  alert if file NOT modified within time_span (detect stale backups, broken pipelines)
## check label: "filecheck::mtime", target label: targets joined by comma
[instances.mtime]
severity = "Warning"
mode = "changed"
time_span = "3m"
# title_rule = "[check] [target]"

## Dimension 2: checksum - alert if file SHA256 changed since last check
## First run stores baselines only; alerts start from the second run
## max_file_size: files larger than this are skipped, default "50MB"
## Supports: "512KB", "50MB", "1GB", etc.
# [instances.checksum]
# severity = "Critical"
# max_file_size = "50MB"
# title_rule = "[check] [target]"

## Dimension 3: existence - alert if any target is missing or glob matches nothing
## Also reports targets that exist but cannot be accessed (permission denied, etc.)
# [instances.existence]
# severity = "Critical"
# title_rule = "[check] [target]"

[instances.alerting]
for_duration = 0
repeat_interval = "5m"
repeat_number = 3
